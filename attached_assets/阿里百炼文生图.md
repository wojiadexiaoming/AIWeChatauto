好的，根据您提供的 DashScope SDK 调用方式，我为您编写一个通用的 Python 图像生成方法。这个方法会包含正反提示词、图片比例和采样步数作为参数，其他参数将使用模型默认值或留空。

Generated python
import os
import requests
from http import HTTPStatus
from urllib.parse import urlparse, unquote
from pathlib import PurePosixPath
from dashscope import ImageSynthesis, Generation  # Import Generation for general API calls if needed

def generate_image(
    model_name: str,
    positive_prompt: str,
    negative_prompt: str = "",
    size: str = "1024*1024",  # Default resolution
    steps: int = None,        # Let model default if None
    num_images: int = 1,      # Default to generating 1 image
    seed: int = None,         # Let model generate random seed if None
    guidance_scale: float = None, # Let model default if None (e.g., FLUX defaults to 3.5)
    output_dir: str = ".",    # Directory to save images
    use_async_call: bool = False # Whether to use asynchronous call
) -> dict:
    """
    使用DashScope SDK生成图像。

    Args:
        model_name (str): 指定用于图像生成的模型名，例如 "wanx2.1-t2i-turbo", "flux-schnell" 等。
        positive_prompt (str): 用户输入的期望模型生成的文本信息（正向提示词）。
                                中文不超过 500 个字符，英文不超过 500 个单词。
        negative_prompt (str, optional): 用户输入的期望模型避免生成的文本信息（反向提示词）。
                                         Defaults to "" (空字符串表示不使用反向提示词)。
        size (str, optional): 生成图像的分辨率，支持 "512*1024", "768*512", "768*1024",
                              "1024*576", "576*1024", "1024*1024"。Defaults to "1024*1024"。
        steps (int, optional): 图片生成的推理步数。如果为 None，则使用模型默认值。
                               Defaults to None。
        num_images (int, optional): 生成图片的数量。Defaults to 1。
        seed (int, optional): 图片生成时的种子值。如果为 None，则算法自动用一个随机生成的数字作为种子。
                              Defaults to None。
        guidance_scale (float, optional): 指导度量值。如果为 None，则使用模型默认值。
                                          Defaults to None。
        output_dir (str, optional): 保存生成图片的目录。Defaults to当前目录 "."。
        use_async_call (bool, optional): 是否使用异步调用方式。如果为 True，函数会立即返回任务信息，
                                         需要手动调用 wait 获取结果。Defaults to False (同步调用)。

    Returns:
        dict: 包含生成结果和任务信息的字典，或者错误信息。
              如果 use_async_call 为 True，返回的是创建任务的响应，
              需要进一步处理才能获取图片URL。
    """

    # 确保API Key已设置
    api_key = os.getenv("DASHSCOPE_API_KEY")
    if not api_key:
        print("错误：请先设置 DASHSCOPE_API_KEY 环境变量。")
        print("例如：os.environ[\"DASHSCOPE_API_KEY\"] = \"YOUR_API_KEY\"")
        return {"status": "error", "message": "API Key not set."}

    # 构建调用参数字典
    params = {
        "api_key": api_key,
        "model": model_name,
        "prompt": positive_prompt,
        "n": num_images,
        "size": size,
    }

    if negative_prompt:
        params["negative_prompt"] = negative_prompt
    if steps is not None:
        params["steps"] = steps
    if seed is not None:
        params["seed"] = seed
    if guidance_scale is not None:
        params["guidance"] = guidance_scale # Note: The parameter name is 'guidance' in the API doc, not 'guidance_scale'

    print(f"正在使用模型: {model_name}, 提示词: {positive_prompt}")
    print(f"请求参数: {params}")

    if use_async_call:
        print("----使用异步调用----")
        rsp = ImageSynthesis.async_call(**params)
        print("异步任务已创建:", rsp)
        if rsp.status_code == HTTPStatus.OK:
            # 对于异步调用，这里只返回任务信息，需要用户后续调用 ImageSynthesis.wait(rsp)
            # 来获取最终结果并下载图片
            return {"status": "task_created", "response": rsp.output, "task_object": rsp}
        else:
            return {
                "status": "error",
                "message": f"创建异步任务失败, 状态码: {rsp.status_code}, 错误码: {rsp.code}, 消息: {rsp.message}"
            }
    else:
        print("----使用同步调用，请稍候----")
        try:
            rsp = ImageSynthesis.call(**params)
            print("同步调用响应:", rsp)
            if rsp.status_code == HTTPStatus.OK:
                # 在指定目录下保存图片
                if not os.path.exists(output_dir):
                    os.makedirs(output_dir)
                
                downloaded_urls = []
                for result in rsp.output.results:
                    file_name = PurePosixPath(unquote(urlparse(result.url).path)).parts[-1]
                    file_path = os.path.join(output_dir, file_name)
                    try:
                        with open(file_path, 'wb+') as f:
                            f.write(requests.get(result.url).content)
                        print(f"图片已保存到: {file_path}")
                        downloaded_urls.append(result.url)
                    except Exception as e:
                        print(f"下载图片 {result.url} 失败: {e}")

                return {
                    "status": "success",
                    "response": rsp.output,
                    "usage": rsp.usage,
                    "downloaded_urls": downloaded_urls
                }
            else:
                return {
                    "status": "error",
                    "message": f"同步调用失败, 状态码: {rsp.status_code}, 错误码: {rsp.code}, 消息: {rsp.message}"
                }
        except Exception as e:
            return {"status": "exception", "message": f"同步调用发生异常: {e}"}

if __name__ == "__main__":
    # --- 配置您的API Key ---
    # 强烈建议将API Key配置到环境变量中，以提高安全性
    # export DASHSCOPE_API_KEY="YOUR_DASHSCOPE_API_KEY"
    # 如果您没有配置环境变量，可以在代码中直接设置，但请注意安全风险：
    # os.environ["DASHSCOPE_API_KEY"] = "YOUR_DASHSCOPE_API_KEY"
    
    # --- 示例用法：同步调用通义万相2.1-文生图-Turbo ---
    print("\n--- 示例1: 同步调用 wanx2.1-t2i-turbo ---")
    result_sync = generate_image(
        model_name="wanx2.1-t2i-turbo",
        positive_prompt="一间有着精致窗户的花店，漂亮的木质门，摆放着花朵，超高清，电影级别光影",
        negative_prompt="模糊，低质量，扭曲",
        size="1024*1024",
        num_images=1,
        output_dir="./generated_images_sync"
    )
    if result_sync["status"] == "success":
        print("图片生成成功！")
        print("下载的图片URL:", result_sync.get("downloaded_urls"))
    else:
        print("图片生成失败或发生异常:", result_sync.get("message"))

    # --- 示例用法：异步调用 FLUX-schnell ---
    print("\n--- 示例2: 异步调用 flux-schnell ---")
    # 异步调用不会立即下载图片，它会返回一个任务对象
    task_result = generate_image(
        model_name="flux-schnell",
        positive_prompt="Eagle flying freely in the blue sky and white clouds, hyperrealistic, 8k",
        size="1024*1024",
        steps=10, # 示例：指定采样步数
        use_async_call=True
    )

    if task_result["status"] == "task_created":
        print("\n异步任务创建成功，等待任务完成...")
        task_obj = task_result["task_object"]
        
        # 等待任务完成并获取结果
        final_rsp = ImageSynthesis.wait(task_obj)
        print("异步任务最终响应:", final_rsp)
        
        if final_rsp.status_code == HTTPStatus.OK:
            output_dir_async = "./generated_images_async"
            if not os.path.exists(output_dir_async):
                os.makedirs(output_dir_async)
            
            downloaded_urls_async = []
            for result in final_rsp.output.results:
                file_name = PurePosixPath(unquote(urlparse(result.url).path)).parts[-1]
                file_path = os.path.join(output_dir_async, file_name)
                try:
                    with open(file_path, 'wb+') as f:
                        f.write(requests.get(result.url).content)
                    print(f"异步任务图片已保存到: {file_path}")
                    downloaded_urls_async.append(result.url)
                except Exception as e:
                    print(f"下载图片 {result.url} 失败: {e}")
            print("异步图片生成成功！")
            print("下载的图片URL:", downloaded_urls_async)
        else:
            print("异步任务执行失败:", final_rsp.message)
    else:
        print("异步任务创建失败:", task_result.get("message"))

    # --- 示例用法：同步调用 AI试衣-Plus版 (假设它支持相同的参数) ---
    print("\n--- 示例3: 同步调用 aitryon-plus (注意：实际参数可能不同，请查阅官方文档) ---")
    result_aitryon = generate_image(
        model_name="aitryon-plus",
        positive_prompt="一个穿着时尚连衣裙的模特，展示最新款服装，高品质，摄影棚灯光",
        size="1024*1024", # 假设该模型支持此尺寸
        output_dir="./generated_aitryon_images"
    )
    if result_aitryon["status"] == "success":
        print("AI试衣图片生成成功！")
        print("下载的图片URL:", result_aitryon.get("downloaded_urls"))
    else:
        print("AI试衣图片生成失败或发生异常:", result_aitryon.get("message"))


代码说明：

安装SDK:
请确保您的环境中已经安装了 DashScope SDK，并且是最新版本。如果尚未安装，请运行：

Generated bash
pip install --upgrade dashscope
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution. 
Bash
IGNORE_WHEN_COPYING_END

配置API Key:
在运行代码之前，您需要将您的 DashScope API Key 配置到环境变量中。这是最推荐的方式，因为它更安全，避免了将敏感信息硬编码到代码中。

Linux/macOS: export DASHSCOPE_API_KEY="YOUR_API_KEY"

Windows (CMD): set DASHSCOPE_API_KEY="YOUR_API_KEY"

Windows (PowerShell): $env:DASHSCOPE_API_KEY="YOUR_API_KEY"
或者，您也可以在 Python 代码中直接设置（不推荐用于生产环境）：
os.environ["DASHSCOPE_API_KEY"] = "YOUR_DASHSCOPE_API_KEY"
请将 "YOUR_DASHSCOPE_API_KEY" 替换为您的实际 API Key。

generate_image 函数：

model_name: 必填。指定要调用的模型名称（例如 wanx2.1-t2i-turbo, flux-schnell 等）。

positive_prompt: 必填。您的正向提示词。

negative_prompt: 可选。反向提示词，默认为空字符串。

size: 可选。图片分辨率，默认为 1024*1024。

steps: 可选。推理步数，默认为 None，意味着使用模型自身的默认值。

num_images: 可选。生成图片数量，默认为 1。

seed: 可选。随机种子，默认为 None，意味着每次生成都是随机的。

guidance_scale: 可选。指导度量值，默认为 None，意味着使用模型自身的默认值。

output_dir: 可选。保存生成图片的目录，默认为当前目录。

use_async_call: 可选。一个布尔值，用于控制是进行同步调用 (False，默认) 还是异步调用 (True)。

同步调用 (ImageSynthesis.call): 函数会一直等待直到图片生成并下载完成，然后返回结果。

异步调用 (ImageSynthesis.async_call): 函数会立即返回一个包含任务 task_id 的响应对象。您需要自己调用 ImageSynthesis.wait(task_object) 来等待任务完成并获取最终结果，或者 ImageSynthesis.fetch(task_object) 来查询任务状态。示例中包含了异步调用后等待并下载图片的完整流程。

参数的空值处理：
对于 steps, seed, guidance_scale 等参数，函数默认设置为 None。在构建请求参数字典 params 时，如果这些参数是 None，它们将不会被添加到 params 中，这意味着DashScope服务将使用对应模型的默认值。negative_prompt 默认为空字符串 ""，这也是常用的表示不使用反向提示词的方式。

返回结果：
函数返回一个字典，其中包含 status（"success", "error", "exception", "task_created"）、message 和实际的响应 response 数据。对于同步调用成功，还会包含 usage 信息和 downloaded_urls 列表。对于异步任务创建成功，会返回 task_object 供后续等待和查询。

这个通用方法涵盖了常见的图像生成需求，并为您提供了同步和异步两种调用模式的示例，您可以根据需要进行选择。请记住，不同模型支持的参数和其默认值可能有所不同，查阅具体的API参考文档以获取最准确的信息仍然是最佳实践。